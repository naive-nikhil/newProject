---
import globe from "../assets/globe.png";
import audience from "../assets/audience.png";
import multichannel from "../assets/multichannel.png";

const slides = [
  {
    id: "s1",

    imageHtml: `https://png.pngtree.com/png-clipart/20231107/original/pngtree-blue-glass-light-bulb-icon-isolated-on-a-picture-image_13239328.png`,
    title: "“Create a Story”",
    text: "Craft compelling narratives that emotionally connect and clearly communicate your brand’s purpose. We turn your ideas into stories people remember.",
  },
  {
    id: "s2",

    imageHtml: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" fill="none">
    <defs>
      <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
      </linearGradient>
    </defs>
    <path fill="url(#gradient1)" d="M31.685,40.732 L39.406,55.937 L48.042,46.698 Z"/>
  </svg>`,
    title: "“Understand Your Audience”",
    text: "Identify and target the right audience with precision. We analyze behaviors, needs, and trends to make your marketing truly impactful.",
  },
  {
    id: "s3",

    imageHtml: multichannel.src,
    title: "“Boost Your Online Presence”",
    text: "Strengthen your visibility with a strong, authentic, and relevant digital footprint. We help your brand stand out on search engines, social media, and key digital spaces.",
  },
  {
    id: "s4",

    imageHtml: globe.src,
    title: "“Multichannel Activation”",
    text: "Build a unified presence across websites, social platforms, Google, and LinkedIn. Your brand stays consistent, powerful, and active everywhere your audience is.",
  },
];
---

<style>
  .mainDiv h2 {
    font-size: 1.5rem;
    line-height: 2.25rem;
    text-align: center;
  }
  @media (min-width: 780px) {
    .mainDiv h2 {
      font-size: 2.75rem;
      line-height: 4.25rem;
      text-align: left;
    }
  }
  @media (max-width: 990px) {
    .imageTesti {
      display: none;
    }
  }
  @media (min-width: 1200px) {
    .mainDiv h2 {
      font-size: 2rem;
    }
  }
  @media (min-width: 1400px) {
    .mainDiv h2 {
      font-size: 3.7rem;
    }
  }

  .slide-item {
    transition:
      opacity 300ms ease,
      transform 300ms ease;
  }
  .hidden {
    display: none !important;
  }
  .slide-visible {
    display: flex !important;
    opacity: 1;
    transform: translateY(0);
  }
  .slide-hidden {
    opacity: 0;
    transform: translateY(8px);
  }

  .controls {
    display: inline-flex;
    gap: 0.5rem;
  }
  .control-btn {
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.5rem;
    cursor: pointer;
  }
  .control-btn:focus {
    outline: 2px solid rgba(0, 0, 0, 0.12);
    outline-offset: 2px;
  }

  /* small visual niceties for dots */
  .dot {
    width: 0.65rem;
    height: 0.65rem;
    border-radius: 9999px;
  }
  .dot.active {
    background: #000;
  }
  .dot.inactive {
    background: #ddd;
  }
</style>

<div class="w-screen flex justify-center">
  <div class="bg-white/30 w-[80%] py-20 font-san mainDiv">
    <h2
      class="text-[1.5rem] mx-5 text-[#474747] text-left lg:text-center mb-10"
    >
      Our Roles
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 max-w-5xl">
      <p class="text-lg text-gray-700 leading-relaxed font-light">
        For any brand or business, storytelling is the foundation of brand
        building.
      </p>
      <p class="text-lg text-gray-700 leading-relaxed font-light">
        At Technovel, we help brands communicate with clarity, creativity, and
        impact. Our approach combines strategic insight, audience understanding,
        and powerful digital execution to shape strong brand identities. From
        crafting meaningful stories to activating your presence across multiple
        channels, we ensure your brand connects, engages, and grows.
      </p>
    </div>
  </div>
</div>

<div class="font-sans sm:mx-5 mx-5 py-7">
  <div class="flex items-center space-x-4 md:space-x-6">
    <div class="w-full">
      <!-- map slides -->
      {
        slides.map((slide, i) => (
          <div
            key={slide.id}
            class={`flex h-[45vh] bg-white/30 flex-col md:flex-row slide-item max-w-7xl shadow-xl rounded-2xl mx-auto overflow-hidden ${i === 0 ? "slide-visible" : "hidden slide-hidden"}`}
            data-index={i}
          >
            <div class="flex border-[#d3ecfd] border-2 bg-[#f5f4fb] imageTesti items-center justify-center h-16 md:p-16 mr-6 rounded-2xl w-full md:w-1/3 min-h-full">
              <div class="relative w-24 h-28 ">
                <div class="absolute inset-0 blur-2xl  bg-[#f5f4fb] rounded-full" />

                <div
                  aria-hidden="true"
                  class="w-[13vw] h-[13vw] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2  "
                >
                  <img src={slide.imageHtml} alt="" class="w-full h-full " />
                </div>
              </div>
            </div>

            <div class="flex   flex-col bg-[#f5f4fb] justify-center h-full items-center text-left rounded-2xl w-full md:w-full">
              <blockquote class="text-3xl sm:text-4xl font-normal text-gray-600 leading-snug mb-6">
                {slide.title}
              </blockquote>
              <p class="text-lg text-gray-600 w-[60%] text-wrap ">
                {slide.text}
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>

  <div
    class="flex space-x-2 mt-8 max-w-5xl mx-auto px-4 md:px-0 items-center justify-between"
  >
    <div class="controls">
      <button
        class="control-btn prev h-9 flex items-center justify-center bg-black text-white rounded-xl transition-colors hover:bg-gray-700"
        aria-label="Previous slide"
        title="Previous"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <button
        class="control-btn next h-9 flex items-center justify-center bg-black text-white rounded-xl transition-colors hover:bg-gray-700"
        aria-label="Next slide"
        title="Next"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    <div class="dots flex items-center gap-2" aria-hidden="false">
      {
        slides.map((_, i) => (
          <button
            class={`dot ${i === 0 ? "active" : "inactive"}`}
            data-dot-index={i}
            aria-label={`Go to slide ${i + 1}`}
            title={`Slide ${i + 1}`}
          />
        ))
      }
    </div>
  </div>
</div>

<!-- Inline script so Astro runs it client-side -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1. Select all slide items using querySelectorAll
    const slides = document.querySelectorAll(".slide-item");
    // 2. Select buttons correctly by getting the first element of the collection
    const prevButton = document.getElementsByClassName("prev")[0];
    const nextButton = document.getElementsByClassName("next")[0];
    // select dots
    const dots = document.querySelectorAll("[data-dot-index]");
    let currentSlide = 0;

    function showSlide(index) {
      // guard: no slides
      if (!slides || slides.length === 0) return;

      // hide all slides
      slides.forEach((slide) => {
        slide.style.display = "none";
        slide.classList.remove("slide-visible");
        slide.classList.add("slide-hidden");
      });

      // normalize index (wrap-around)
      index = ((index % slides.length) + slides.length) % slides.length;

      // show the requested slide
      slides[index].style.display = "flex";
      slides[index].classList.remove("slide-hidden");
      slides[index].classList.add("slide-visible");

      // update dots
      if (dots && dots.length) {
        dots.forEach((d, i) => {
          if (i === index) {
            d.classList.remove("inactive");
            d.classList.add("active");
          } else {
            d.classList.remove("active");
            d.classList.add("inactive");
          }
        });
      }

      currentSlide = index;
    }

    function nextSlide() {
      // Use slides.length
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    }

    function prevSlide() {
      // handle wrap-around correctly
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(currentSlide);
    }

    // Attach listeners to the button elements
    if (nextButton) {
      nextButton.addEventListener("click", nextSlide);
    }
    if (prevButton) {
      prevButton.addEventListener("click", prevSlide);
    }

    // Attach listeners to dots if present
    if (dots && dots.length) {
      dots.forEach((dot) => {
        dot.addEventListener("click", (e) => {
          const idx = Number(dot.getAttribute("data-dot-index"));
          if (!Number.isNaN(idx)) showSlide(idx);
        });
      });
    }

    // Initialize: show the first slide
    showSlide(currentSlide);
  });
</script>
