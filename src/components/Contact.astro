---
import blobShape1 from "../assets/blob_shape1.svg";
import blobShape2 from "../assets/blob_shape2.svg";
---

<style>
  /* Reuse your responsive font sizes */
  @media (min-width: 780px) {
    .mainDiv h2 {
      font-size: 2.75rem;
      line-height: 4.25rem;
    }
  }
  @media (min-width: 1200px) {
    .mainDiv h2 {
      font-size: 2rem;
    }
  }
  @media (min-width: 1400px) {
    .mainDiv h2 {
      font-size: 4rem;
    }
  }

  /* iOS-safe overflow handling for blobs */
  .contact-blob-container {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }
</style>

<div
  id="contact-root"
  class="scroll-mt-20 w-full py-20 relative px-4 flex justify-center items-center"
  style="overflow: hidden; overflow: clip;"
>
  <!-- Blobs wrapped in overflow container -->
  <div class="contact-blob-container">
    <img
      id="contact-blob1"
      src={blobShape1.src}
      alt=""
      class="absolute -top-10 left-0 -translate-x-1/3 max-w-[300px] sm:max-w-[500px] rotate-10 pointer-events-none opacity-80"
    />
    <img
      id="contact-blob2"
      src={blobShape2.src}
      alt=""
      class="absolute top-40 sm:top-20 right-0 translate-x-1/3 sm:translate-x-1/6 max-w-[320px] sm:max-w-[550px] rotate-10 pointer-events-none opacity-80"
    />
  </div>

  <div class="w-full max-w-4xl relative z-10">
    <div
      class="mainDiv w-full bg-white/60 backdrop-blur-md border-2 border-white rounded-3xl p-6 md:p-12 lg:p-16 shadow-xl shadow-[#006cb7]/10"
    >
      <h2
        class="text-[2.5rem] leading-[3rem] font-bold text-center mb-8 text-[#006cb7]"
      >
        Got questions?
      </h2>

      <form id="contactForm" class="space-y-6" novalidate>
        <div>
          <label
            for="full-name"
            class="block text-sm font-semibold text-slate-600 mb-2 pl-1"
            >Full name</label
          >
          <input
            id="full-name"
            name="full-name"
            required
            type="text"
            class="block w-full rounded-xl border-2 border-transparent bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400 focus:border-[#006cb7]/30 focus:bg-white focus:outline-none transition-all duration-300 shadow-sm"
            placeholder="John Doe"
          />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              for="email"
              class="block text-sm font-semibold text-slate-600 mb-2 pl-1"
              >Email</label
            >
            <input
              id="email"
              name="email"
              required
              type="email"
              class="block w-full rounded-xl border-2 border-transparent bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400 focus:border-[#006cb7]/30 focus:bg-white focus:outline-none transition-all duration-300 shadow-sm"
              placeholder="john@example.com"
            />
          </div>

          <div>
            <label
              for="telephone"
              class="block text-sm font-semibold text-slate-600 mb-2 pl-1"
              >Telephone</label
            >
            <input
              id="telephone"
              name="telephone"
              type="tel"
              class="block w-full rounded-xl border-2 border-transparent bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400 focus:border-[#006cb7]/30 focus:bg-white focus:outline-none transition-all duration-300 shadow-sm"
              placeholder="+1 (555) 000-0000"
            />
          </div>
        </div>

        <div>
          <label
            for="message"
            class="block text-sm font-semibold text-slate-600 mb-2 pl-1"
            >Message</label
          >
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            class="block w-full rounded-xl border-2 border-transparent bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400 focus:border-[#006cb7]/30 focus:bg-white focus:outline-none transition-all duration-300 shadow-sm resize-none"
            placeholder="How can we help you?"
          ></textarea>
        </div>

        <div class="flex items-center pt-2 pl-1">
          <input
            id="terms"
            name="terms"
            type="checkbox"
            required
            class="h-5 w-5 rounded border-gray-300 text-[#006cb7] focus:ring-[#006cb7]"
          />
          <label for="terms" class="ml-3 text-sm text-slate-500">
            I accept the <a href="#" class="text-[#006cb7] font-medium hover:underline">terms</a>.
          </label>
        </div>

        <div class="pt-4">
          <button
            id="submitBtn"
            type="submit"
            class="w-full py-4 rounded-xl text-white font-bold tracking-wide bg-[#006cb7] hover:bg-[#f38023] shadow-lg shadow-[#006cb7]/20 hover:shadow-[#f38023]/30 transition-all duration-300 transform hover:-translate-y-1 cursor-pointer"
          >
            Send Message
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script type="module" defer>
  import gsap from "https://cdn.jsdelivr.net/npm/gsap@3.12.5/index.js";
  import { ScrollTrigger } from "https://cdn.jsdelivr.net/npm/gsap@3.12.5/ScrollTrigger.min.js";

  gsap.registerPlugin(ScrollTrigger);

  const contactSection = document.querySelector("#contact-root");
  const contactBlob1 = document.querySelector("#contact-blob1");
  const contactBlob2 = document.querySelector("#contact-blob2");

  if (contactSection && contactBlob1 && contactBlob2) {
    
    // Animate Blob 1 (Left)
    gsap.to(contactBlob1, {
      y: 200, 
      opacity: 0,
      duration: 2,
      scrollTrigger: {
        trigger: contactSection,
        start: "top bottom", 
        end: "bottom top",  
        scrub: 1,            
      },
    });

    // Animate Blob 2 (Right)
    gsap.to(contactBlob2, {
      y: 350,
      opacity: 0,
      duration: 2,
      scrollTrigger: {
        trigger: contactSection,
        start: "top bottom",
        end: "bottom top",
        scrub: 1.5,
      },
    });
  }

  // ============================================
  // GOOGLE SHEETS FORM SUBMISSION
  // ============================================
  // IMPORTANT: Replace this URL with your Google Apps Script Web App URL
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby4npd6eiIICOG0fo3FxLdggI00yDXhJexfNrBQt1bKIIMuqQkaisBo7AwyGkGDr3z7/exec';

  const contactForm = document.getElementById('contactForm');
  const submitBtn = document.getElementById('submitBtn');

  if (contactForm && submitBtn) {
    contactForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate form
      const fullName = document.getElementById('full-name').value.trim();
      const email = document.getElementById('email').value.trim();
      const telephone = document.getElementById('telephone').value.trim();
      const message = document.getElementById('message').value.trim();
      const terms = document.getElementById('terms').checked;

      if (!fullName || !email || !message) {
        alert('Please fill in all required fields.');
        return;
      }

      if (!terms) {
        alert('Please accept the terms to continue.');
        return;
      }

      // Update button state
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      submitBtn.classList.add('opacity-70', 'cursor-not-allowed');

      try {
        // Prepare form data
        const formData = {
          fullName: fullName,
          email: email,
          telephone: telephone,
          message: message,
          timestamp: new Date().toISOString()
        };

        // Send to Google Sheets
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // Required for Google Apps Script
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        // Show success message
        submitBtn.textContent = 'Message Sent! âœ“';
        submitBtn.classList.remove('bg-[#006cb7]');
        submitBtn.classList.add('bg-green-500');
        
        // Reset form
        contactForm.reset();

        // Reset button after 3 seconds
        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-70', 'cursor-not-allowed', 'bg-green-500');
          submitBtn.classList.add('bg-[#006cb7]');
        }, 3000);

      } catch (error) {
        console.error('Error submitting form:', error);
        submitBtn.textContent = 'Error! Try Again';
        submitBtn.classList.remove('bg-[#006cb7]');
        submitBtn.classList.add('bg-red-500');

        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-70', 'cursor-not-allowed', 'bg-red-500');
          submitBtn.classList.add('bg-[#006cb7]');
        }, 3000);
      }
    });
  }
</script>